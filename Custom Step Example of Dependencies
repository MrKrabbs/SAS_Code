{"creationTimeStamp":"2023-01-10T18:02:57.471Z","modifiedTimeStamp":"2023-01-10T21:40:33.269Z","createdBy":"student","modifiedBy":"student","name":"Retired Jan 10th Good Example of Dependencies Add Model Predicted Values From GLM and VDMML.step","displayName":"Retired Jan 10th Good Example of Dependencies Add Model Predicted Values From GLM and VDMML.step","localDisplayName":"Retired Jan 10th Good Example of Dependencies Add Model Predicted Values From GLM and VDMML.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","uri":"/dataFlows/steps/b465eeca-a31f-4684-9556-a70eded4c99d","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":1,"maxEntries":1,"type":"table"},{"name":"vdmml_tbl_1","displayName":"vdmml_tbl_1","localDisplayName":"vdmml_tbl_1","minEntries":0,"maxEntries":1,"type":"table"},{"name":"vdmml_tbl_2","displayName":"vdmml_tbl_2","localDisplayName":"vdmml_tbl_2","minEntries":0,"maxEntries":1,"type":"table"},{"name":"vdmml_tbl_3","displayName":"vdmml_tbl_3","localDisplayName":"vdmml_tbl_3","minEntries":0,"maxEntries":1,"type":"table"}],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"PageAddPredictedValues\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Add Predicted Values\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Select Table Used To Build Model\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionVDMML\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Option to ADD VDMML Models\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"GLM Models will automatically have their predicted values joined to the table. Below you can select up to three models created in VDMML - Model Studio so that you have have their predicted values joined to the table.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"vdmml_tbl_1\",\n\t\t\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\t\t\"label\": \"Select Table Created in VDMML Using SAS Score Node\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"vdmml_tbl_2\",\n\t\t\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\t\t\"label\": \"Select Additional Scored Table Created in VDMML\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"visible\": \"$vdmml_tbl_1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"vdmml_tbl_3\",\n\t\t\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\t\t\"label\": \"Select Additional Scored Table Created in VDMML\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"visible\": \"$vdmml_tbl_2\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"colselTarget\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select Target\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"inputtable1\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"vdmml_tbl_1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"vdmml_tbl_2\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"vdmml_tbl_3\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"colselTarget\": []\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n%let myTable=TEMP_MERGE;\n%let myCasLibrary=CASUSER;\n%LET myTarget=&colselTarget_1_name.;\n\n/* The macro variables &RUN_MY_SCORING1(2,3,4..) will have a value something like this: score_77434.sas */\nPROC SQL NOPRINT;\nSELECT DISTINCT MY_CODE_FILE,RUNTIME INTO :RUN_MY_SCORING1-, :DO_NOT_USE1- FROM DATAFLDR.AIC_TBL_STUDENT WHERE MY_CODE_FILE IS NOT NULL\nORDER BY RUNTIME DESC;\nSELECT count(*) INTO :NBR_OF_RUNS FROM DATAFLDR.AIC_TBL_STUDENT WHERE MY_CODE_FILE IS NOT NULL;\nQUIT;\n\n%let maxRuns = %sysfunc(MIN(&NBR_OF_RUNS, 5));\n\n%MACRO APPLY_GLM_SCORE;\n\nDATA CASUSER.TEMP_GLM_SCORES;\nSET &inputtable1.;\n%DO A = 1 %TO &maxRuns.;\n\tLENGTH \tP_MDL_&A._TYPE $20.;\n\tP_MDL_&A._TYPE = 'GLM';\n%END;\n\nRUN;\n\n/* maxRuns below will be between 1 and 5, ECAUSE THAT IS WHAT THE  VA REPORT IS SETUP FOR IN TERMS OF COMPARING MODELS*/\n%DO I = 1 %TO &maxRuns.;\n\nfilename sfile filesrvc folderpath='/Users/student/My Folder/My_GLM_Score_Programs' \n\tfilename=\"&&RUN_MY_SCORING&I.\";\n\ndata CASUSER.TEMP_GLM_SCORES;\n\tset CASUSER.TEMP_GLM_SCORES;\n\t%include sfile;\n\tRENAME P_&myTarget. =P_MDL_&I.;\n\tLABEL P_&myTarget. = \"P_MDL_&I.\";\n\n\n\t\nrun;\n\nfilename sfile CLEAR;\n\nproc sql noprint;\n\tupdate DATAFLDR.AIC_TBL_STUDENT \n\tset MDL_NBR=&I. ,MODEL_NAME=\"GLM_&I.\"\n\twhere MY_CODE_FILE=\"&&RUN_MY_SCORING&I.\" ;\nquit;\n\n%END;\n\n%MEND APPLY_GLM_SCORE;\n\n%APPLY_GLM_SCORE ;\n\n%MACRO APPLY_VDMML_SCORE(VDMMLTBL,MDLNBR);\n/**********************  NOW LETS BRING IN MODELS FROM VDMML IF WE HAVE ANY         *********************************************/\n/* BELOW IS A VDMML TABLE YOU CREATED WITH THE SCORING NODE */\nPROC CONTENTS DATA=&VDMMLTBL. OUT=PRED_INFO(KEEP=NAME) NOPRINT;RUN;\n\n/* the Value of the macro &RANDOM_PRED_NAME will be something like: IntGrpLR_PUREPREMIUM  and IntGrpLR is the Model Name you provided in VDMML (Model Studio) */\nPROC SQL NOPRINT;\nSELECT DISTINCT NAME INTO :RANDOM_PRED_NAME FROM WORK.PRED_INFO WHERE UPCASE(NAME) NOT IN ('UNIQUERECORDID');\nSELECT SCAN(NAME,1,'_') INTO:MODEL_TYPE FROM WORK.PRED_INFO WHERE UPCASE(NAME) NOT IN ('UNIQUERECORDID');\nQUIT;\n\n\nDATA CASUSER.TEMP_VDMML_SCORES;\nSET &VDMMLTBL.;\nLENGTH \tP_MDL_&MDLNBR._TYPE $20.;\nP_MDL_&MDLNBR._TYPE=\"&MODEL_TYPE.\";\nLABEL &RANDOM_PRED_NAME.='';\nRENAME &RANDOM_PRED_NAME.=P_MDL_&MDLNBR.;\nRUN;\n\n%IF &MDLNBR=6 %THEN\n%DO;\ndata CASUSER.TEMP_MERGE;\n\tmerge CASUSER.TEMP_GLM_SCORES CASUSER.TEMP_VDMML_SCORES;\n\tby uniqueRecordID;\nrun;\n%END;\n%ELSE\n%DO;\ndata CASUSER.TEMP_MERGE;\n\tmerge CASUSER.TEMP_MERGE CASUSER.TEMP_VDMML_SCORES;\n\tby uniqueRecordID;\nrun;\n%END;\n\nproc casutil;\n\tdroptable incaslib=\"CASUSER\" casdata=\"TEMP_VDMML_SCORES\" quiet;\nrun;QUIT;\n\n%MEND APPLY_VDMML_SCORE;\n\n/* BECAUSE OF THE NOT CONDITION, IF MACRO VALUE EQUALS . THEN CODE WILL NOT EXECUTE. IF MACRO VALUE IS NOT EQUAL . , THEN CODE WILL EXECUTE */\n%IF NOT(&vdmml_tbl_1. = .) %THEN \n%DO;\n%APPLY_VDMML_SCORE(&vdmml_tbl_1.,6);\n%END;\n\n%IF NOT(&vdmml_tbl_2. = .) %THEN \n%DO;\n%APPLY_VDMML_SCORE(&vdmml_tbl_2.,7);\n%END;\n\n%IF NOT(&vdmml_tbl_3. = .) %THEN \n%DO;\n%APPLY_VDMML_SCORE(&vdmml_tbl_3.,8);\n%END;\n\n\n\n\n/* below we strip off the labels as VA uses the labels as the variable names and that can make it difficult to find */\n/* variables that they want to add to a model in VA as VA shows the label and not variable name. By removing label, VA will use variable name */\nproc cas;\n\tsession casauto;\n\n\t/* below will do two things, print out the formats before changing and creating a temp table r that holds info on the columns(variables) */\n\ttable.columninfo result=r / table={caslib=\"&myCasLibrary.\", name=\"&myTable.\"};\n\trun;\n\n\t/* print to the results window column info, specifically formats if they exist */\n\tprint r;\n\trun;\n\n\t/* the object cols below is an array */\n\tcols={};\n\n\tdo row over r.ColumnInfo;\n\t\tcols=cols + {{name=row.Column, label=\"\"}};\n\tend;\n\n\t/* below will print out our array called cols, IMPORTANT, the array will be printed to the log and NOT the results window */\n\t/* this array will simply have the column name and format=missing\\blank\\empty */\n\tprint cols;\n\trun;\n\n\t/* below will alter our table by setting all formats to missing (empty) by leveraging the array called cols */\n\ttable.altertable / caslib=\"&myCasLibrary.\", columns=cols, name=\"&myTable.\";\n\ttable.columninfo result=t / table={caslib=\"&myCasLibrary.\", name=\"&myTable.\"};\n\trun;\n\tprint t;\n\trun;\n\n\nquit;\n\n\nproc casutil;\n\tdroptable incaslib=\"PUBLIC\" casdata=\"VISUALIZE_MODELS\" quiet;\nrun;QUIT;\n\nDATA PUBLIC.VISUALIZE_MODELS(PROMOTE=YES);\n\tSET CASUSER.TEMP_MERGE;\n\nRUN;\n\nproc casutil;\n\tdroptable incaslib=\"PUBLIC\" casdata=\"MODEL_INFO\" quiet;\nrun;QUIT;\n\nDATA PUBLIC.MODEL_INFO(PROMOTE=YES);\n\tSET DATAFLDR.AIC_TBL_STUDENT\n;\n\nIF  ITERATION_NAME = 'VARIABLES FROM ALL ITERATIONS' THEN MDL_NBR = 0;\n\nRUN;\n\nproc casutil;\n\tdroptable incaslib=\"CASUSER\" casdata=\"TEMP_MERGE\" quiet;\nrun;QUIT;"}}
